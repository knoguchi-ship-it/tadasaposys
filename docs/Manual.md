
# タダサポ管理システム 運用マニュアル

**作成日:** 2026/01/27
**更新日:** 2026/02/23
**対象:** 開発者 / システム管理者 / スタッフ

本ドキュメントは、タダサポ管理アプリケーションの環境構築および操作手順書です。

---

## 1. 前提条件
*   Google Workspaceアカウント、またはGmailアカウントを保有していること。
*   対象のスプレッドシートへの編集権限があること。
*   「タダメンマスタ」シートのC列に自分のメールアドレスが登録されていること。

---

## 2. スプレッドシートの準備

### 2.1 シート（タブ）名の設定
以下のシート名を正確に設定してください（空白スペース等に注意）。
1.  `案件リスト`
2.  `サポート記録`
3.  `タダメンマスタ`
4.  `設定`（初回は `setupSettingsSheet` で自動作成可）

※ `メール履歴` シートは、アプリ初回送信時に自動作成されます。

### 2.2 列構成の確認（重要）
SDD.md に基づき、以下の列が正しく配置されているか確認してください。
*   **案件リスト**: A列=タイムスタンプ … G列=サービス種別（7列）
*   **サポート記録**: A列=案件ID … Q列=年度上限特例（17列）
*   **タダメンマスタ**: A列=ID, B列=氏名, C列=メール, D列=ロール, E列=有効フラグ

---

## 3. アプリケーションの操作

### 3.1 表示モードの切替

画面上部に **通常 / 閲覧 / 管理** の3つのモードボタンがあります。

| モード | 表示範囲 | 操作 |
|:---|:---|:---|
| **通常** | 自分が担当する案件のみ（未対応は全員共有） | 全操作可能 |
| **閲覧** | 全案件 | 読み取りのみ（編集・メール送信不可） |
| **管理** | 全案件（管理者のみ） | 全操作 + 管理者専用操作 |

### 3.2 新着バッジ

各ステータスタブの右側に **`+N`** の赤いバッジが表示されます。
「最後にそのタブをクリックした時点から増えた案件数」を示します。

*   タブをクリックすると既読化され、バッジが消えます。
*   管理モードでは、ヘッダーの **Bellアイコン** でバッジのON/OFFを切り替えられます。
*   閲覧モードではバッジは表示されません。

### 3.3 検索・フィルタ

サイドバー上部のキーワード入力欄で**常時**検索できます。

**詳細フィルタ**（フィルタアイコンをクリックで展開）:
*   **期間プリセット**: 今月 / 先月 / 今年度 / 前年度 をワンクリックで設定
*   **カスタム期間**: 開始日〜終了日を直接入力
*   **都道府県 / サービス種別** で絞り込み
*   **並び順**: 最新順 / 古い順
*   **担当者フィルタ**（管理モードのみ）: 全件 / 未割当 / 個別担当者

適用中のフィルタは**チップ（pill）**として表示され、個別に削除できます。

### 3.4 管理モード インライン編集（管理者のみ）

管理モードでは、案件詳細画面の以下の要素を **クリックするだけ** で直接編集できます。

| クリック箇所 | 操作内容 |
|:---|:---|
| ステータスバッジ（例：「対応中」） | ステータスをドロップダウンから選択して変更 |
| 担当者バッジ（例：「田中花子」） | 担当者を検索絞り込み付きドロップダウンから変更（100名以上対応） |
| 案件回数（例：「2 / 3」） | 案件ごとの上限を特例変更（空欄で全体設定に戻す） |
| 今年度利用数（例：「5 / 10」） | 年間上限を特例変更（空欄で全体設定に戻す） |

*   特例設定中の案件には **「特例」** バッジが表示されます。
*   ポップオーバーは **Escape キー** または外側クリックで閉じられます。

---

## 4. GASプロジェクトのセットアップ手順（新規環境構築時）

1.  スプレッドシートのメニューから **拡張機能 > Apps Script** を開く。
2.  **コードファイルの配置**:
    *   デフォルトのコードを削除し、`コード.js` の内容を貼り付ける。
3.  **IDの設定**:
    *   `コード.js` 上部 `SPREADSHEET_ID` を対象スプレッドシートのIDに書き換える。
    *   `setupSettingsSheet` を1回実行し、「設定」シートを作成する。
    *   「設定」シートの `ADMIN_EMAILS` に管理者メールアドレスを設定する（カンマ区切りで複数可）。
    *   ファイル添付を使う場合は `ATTACHMENT_FOLDER_ID` にDriveフォルダIDを設定する。
4.  **index.html の配置**:
    *   「ファイル」の `+` ボタンから HTML を選択し、ファイル名を `index` とする。
    *   `index.html` の内容をすべて貼り付ける。
5.  **サービスの追加（必須）**:
    *   エディタ左側の「サービス」の `+` をクリック。
    *   **Google Calendar API** を選択し「追加」。
    *   **Gmail API** を選択し「追加」。

---

## 5. 既存環境へのデプロイ（clasp 使用）

```bash
# 1. 変更前に必ず git commit
git add <files> && git commit -m "description"

# 2. GASにプッシュ（--force 必須）
clasp push --force

# 3. デプロイ更新
clasp deploy -i <DEPLOY_ID> -d "vX.X.X"
```

---

## 6. トラブルシューティング

*   **Q. 「アクセス権限がありません」画面が表示される。**
    *   A. アクセスしているGoogleアカウントのメールアドレスが、「タダメンマスタ」シートのC列に登録されているか確認してください。

*   **Q. 自分の案件が見つからない。**
    *   A. 表示モードが「通常」になっているか確認してください。また、管理者に担当者が正しく設定されているか確認を依頼してください。

*   **Q. 編集ボタンが押せない / グレーアウトしている。**
    *   A. 「閲覧」モードになっていませんか？「通常」モードに切り替えてください。

*   **Q. 新着バッジが消えない。**
    *   A. 該当タブをクリックすると既読化されてバッジが消えます。管理モードのBellボタンでバッジ自体をOFFにすることも可能です。

*   **Q. 管理モードの「管理」ボタンが表示されない。**
    *   A. 「タダメンマスタ」シートのD列（ロール）に `admin` が設定されていない場合、管理モードは表示されません。管理者に設定を依頼してください。
