
# 要件定義書 (Requirements Definition) - タダサポ管理システム

**Version:** 0.7 (Localization Spec)
**Date:** 2026/01/27
**Status:** In Progress

本ドキュメントは、システムが実現すべき**業務要件（ビジネスロジック）**および**ユーザー体験**を定義する。

---

## 1. 業務フロー概要 (Business Flow)

本システムは、Googleフォームから流入するデータを起点とし、以下のフローで業務を進行する。

### Phase 1: 受付 (Input)
1.  **依頼発生**: 依頼者が **Googleフォーム** に入力。
2.  **データ連携**: フォーム回答が自動的にスプレッドシートの「案件リスト」に追加される。
3.  **システム反映**: アプリは「案件リスト」を読み込み、未対応案件としてリスト表示する。

### Phase 2: アサインと調整 (Assign & Adjust)
1.  **案件選択 (Self-Assignment)**:
    *   スタッフは未対応案件の中から、担当する案件を選択する（自分自身への割り当て）。
2.  **制限チェック (BR-01)**:
    *   **10回以下**: 「初回日程調整メール」作成画面へ。
    *   **11回目以上**: 「上限お断りメール」作成画面へ遷移し、送信後に終了処理。
3.  **初回連絡 (Initial Contact)**:
    *   アプリ上で「日程調整のお願い」テンプレートを展開。
    *   内容を編集し、担当者のGmailから送信する。
    *   **ログ保存**: 送信されたメールは「送信履歴」として案件に紐づけられる。
4.  **日程調整 (External Adjustment)**:
    *   依頼者からの返信や具体的な日時のやり取りは、**アプリ外のメーラー（Gmail等）**で行う。
5.  **日時確定とカレンダー連携 (Date Confirmed)**:
    *   日時が決定したらアプリに入力する（必須）。
    *   保存時、**担当者メインカレンダー**と**タダサポ共有カレンダー**に予定を作成し、**Meet URL**を発行する。
6.  **確定メール送信**:
    *   「日時」と「Meet URL」が入った確定メールをアプリから送信する。
    *   **ログ保存**: このメールも履歴に保存される。

### Phase 3: 実施と記録 (Execute & Record)
1.  **支援実施**: 発行されたMeet URL等で支援を行う。
2.  **記録作成**: 支援完了後、アプリ上で「実施記録」を入力・保存する。
3.  **完了報告メール**: アプリから完了報告メールを送信し、履歴に保存する。

### Phase 4: 継続支援 (Recurring Support)
1.  **次回予定**: 対応済み案件に対し、最大3回まで「継続案件」を作成可能。

---

## 2. 業務ルール (Business Rules)

### BR-01: 年間回数制限 (Annual Limit)
*   **キー項目**: メールアドレス (`email`)
*   **期間定義**: 4月1日 〜 翌年3月31日
*   **閾値**: 累計10回までOK、11回目からNG。

### BR-02: 1案件あたりの支援回数制限 (Case Limit)
*   **上限回数**: 3回
*   3回実施済みの案件は「次回（継続）を作成」ボタンを無効化。

### BR-03: カレンダー連携仕様 (Calendar Specs)
*   **作成タイミング**: 日時確定入力時。
*   **作成先**: 担当者カレンダー ＋ タダサポ共有カレンダー。
*   **内容**: タイトル、1時間枠、Google Meet付与。

### BR-04: メール送信仕様 (Mail Specs)
*   **送信元**: 操作スタッフ本人のGmail。
*   **テンプレート種別**:
    1.  **初回日程調整**: 候補日伺いなどの定型文。
    2.  **日時確定**: 日時とMeet URLの通知。
    3.  **完了報告**: 支援完了の挨拶。
    4.  **上限お断り**: 回数制限による丁寧なお断り。
*   **送信ログ (Mail History)**:
    *   アプリから送信したすべてのメール（件名、本文、送信日時、種別）を、案件IDに紐づけてデータベースに記録する。

---

## 3. システム機能要件 (Functional Requirements)

### FR-01: 案件リストとアクセス制御 (Case List & Access Control)
*   **未対応 (Unhandled)**: すべてのスタッフが全件を閲覧・選択可能。
*   **対応中 (InProgress) / 完了 (Completed)**: 原則として、**ログインユーザー自身が担当している案件のみ**を表示・操作可能とする。他者の担当案件はリストに表示しない。

### FR-02: アサインと初回連絡
*   「担当してメールを送る」アクションボタン。
*   メール作成モーダル（テンプレート自動展開、編集可能）。

### FR-03: 日程登録と外部連携
*   日時入力 ＋ カレンダーAPI連携 ＋ Meet発行。

### FR-04: メール履歴表示 (Timeline)
*   案件詳細画面において、アプリ経由で送信されたメールのログを表示する機能。

### FR-05: 継続案件作成
*   既存案件情報のコピー作成機能。

### FR-06: 全体状況ダッシュボード (Dashboard Mode)
*   **機能**: トグルスイッチ等により「通常モード（自分の案件）」と「全体ダッシュボード」モードを切り替える機能。
*   **表示内容**: ダッシュボードモードでは、担当者に関わらず**全てのステータスの全案件**をリスト表示する。
*   **制約**: ダッシュボードモードは**閲覧専用 (Read-Only)** とし、記録の更新、メール送信、ステータス変更などの一切のアクションを不可とする（アクションボタンを非表示または無効化）。

---

## 4. 未確定・確認事項 (TBD)
*   **受信メールの扱い**: 送信ログのみ管理し、受信はGmailで行う運用とする。

---

## 5. 非機能要件 (Non-Functional Requirements)

### NFR-01: ユーザビリティとアクセシビリティ (Usability & Accessibility)
*   **レスポンシブデザイン**: PC、タブレット、スマートフォン（モバイル）のいずれの端末でもレイアウト崩れがなく、操作可能であることを**絶対条件**とする。
*   **アクセシビリティ**:
    *   十分なコントラスト比を確保する。
    *   モバイル操作時におけるタッチターゲットのサイズを適切に確保する。
    *   スクリーンリーダー等の支援技術に配慮したセマンティックなマークアップを行う。
*   **リードビリティ**:
    *   フォントサイズ、行間、配色を適切に設計し、高齢者や視力の弱いスタッフでも読みやすい画面とする。
    *   情報は詰め込みすぎず、余白を活用した見やすいレイアウトとする。

### NFR-02: 言語・表記 (Language & Wording)
*   **日本語優先**: 日本人向けのアプリケーションであるため、UI上のラベル、メッセージ、ボタン名は原則として**日本語**で表記する。
    *   ユーザーが理解しやすい言葉選び（Plain Japanese）を心がける。
    *   例: "Signed in" → "ログイン中"、"Back" → "戻る"
*   **例外**: 一般的に定着しているカタカナ語や英単語（例: ID, Google Meet, Zoom）については英語表記を許容する。
